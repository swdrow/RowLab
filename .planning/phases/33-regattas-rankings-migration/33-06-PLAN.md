---
phase: 33-regattas-rankings-migration
plan: 06
type: execute
wave: 4
depends_on: [33-05]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can see polished race day command center with improved results entry (REG-01)"
    - "User can see live race updates via WebSocket during regattas (REG-02)"
    - "User can see clearer ranking visualizations with animated transitions (RK-01)"
    - "User can see NCAA compliance export for rankings (RK-02)"
    - "User sees connection health indicator (green/yellow/red dot) (RT-02)"
    - "User sees skeleton loaders instead of spinners on every regatta/ranking page (CW-03)"
    - "User can use keyboard shortcuts for common actions (CW-02)"
    - "User experiences optimistic UI for all mutations (CW-01)"
  artifacts: []
  key_links: []
---

<objective>
Human verification of Phase 33 implementation.

Purpose: Confirm all requirements are met visually and functionally before marking the phase complete.

Output: Phase verified or issues documented for gap closure.
</objective>

<execution_context>
@/home/swd/.claude/get-shit-done/workflows/execute-plan.md
@/home/swd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-regattas-rankings-migration/33-01-SUMMARY.md
@.planning/phases/33-regattas-rankings-migration/33-02-SUMMARY.md
@.planning/phases/33-regattas-rankings-migration/33-03-SUMMARY.md
@.planning/phases/33-regattas-rankings-migration/33-04-SUMMARY.md
@.planning/phases/33-regattas-rankings-migration/33-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Automated verification checks</name>
  <files></files>
  <action>
    Run comprehensive automated checks before human verification:

    1. **Build check:** `npm run build` must succeed with zero errors
    2. **TypeScript check:** `npx tsc --noEmit` must pass
    3. **V3 token compliance:** Verify no V1/V2 hardcoded colors remain:
       ```bash
       grep -rn 'bg-gray-\|bg-zinc-\|bg-neutral-\|text-gray-\|text-zinc-\|border-gray-\|border-zinc-' \
         src/v2/components/regatta/ src/v2/components/rankings/ \
         src/v2/pages/RegattasPage.tsx src/v2/pages/RankingsPage.tsx src/v2/pages/AdvancedRankingsPage.tsx
       ```
       Must return zero matches.
    4. **Spinner check:** Verify no spinners remain:
       ```bash
       grep -rni 'spinner\|loading.*spin\|CircularProgress' \
         src/v2/components/regatta/ src/v2/components/rankings/ \
         src/v2/pages/RegattasPage.tsx src/v2/pages/RankingsPage.tsx
       ```
       Must return zero matches.
    5. **New component existence:** Verify all new files created:
       ```bash
       ls src/v2/features/regatta/hooks/useRaceDaySocket.ts \
          src/v2/features/regatta/hooks/useConnectionHealth.ts \
          src/v2/features/regatta/components/ConnectionIndicator.tsx \
          src/v2/features/regatta/components/RegattaSkeleton.tsx \
          src/v2/features/regatta/components/RankingsSkeleton.tsx \
          src/v2/features/regatta/components/OfflineQueueIndicator.tsx \
          src/v2/components/rankings/RankingRow.tsx \
          src/v2/components/rankings/RankingTrendChart.tsx \
          src/v2/components/rankings/NCAAExportDialog.tsx \
          src/v2/hooks/useRegattaKeyboard.ts \
          server/socket/raceDay.js
       ```
       All must exist.
    6. **Test run:** `npm run test:run` must pass (existing tests don't break)
  </action>
  <verify>All 6 automated checks pass with zero failures.</verify>
  <done>Automated checks confirm build success, type safety, V3 compliance, no spinners, all files created, and existing tests pass.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Phase 33: Regattas & Rankings Migration to V3

    **V3 Design Token Migration (Plans 01-02):**
    - 10 regatta components migrated to warm dark design system
    - 3 ranking components migrated
    - 3 pages migrated (RegattasPage, RankingsPage, AdvancedRankingsPage)

    **WebSocket Infrastructure (Plan 03):**
    - Server-side race day event handlers (raceDay.js)
    - Client-side hooks (useRaceDaySocket, useConnectionHealth)
    - Connection health indicator (green/yellow/red dot)

    **Ranking Visualizations (Plan 04):**
    - Animated ranking rows with Framer Motion FLIP layout animations
    - Speed trend sparklines per ranking row
    - NCAA compliance CSV export dialog
    - Improved results entry form UX

    **Cross-Cutting (Plan 05):**
    - Keyboard shortcuts (N/R/?/Escape/E)
    - Optimistic UI on all mutations with offline queue
    - Skeleton loaders replacing all spinners
    - Offline queue indicator for pending mutations
  </what-built>
  <how-to-verify>
    Start the dev server: `cd /home/swd/RowLab && npm run dev:full`
    Access at: http://100.86.4.57:3001

    **1. V3 Design Tokens (REG-01)**
    - Navigate to `/app/regattas` — verify warm dark design system (no gray/zinc colors)
    - Click into a regatta detail — verify glass card effects, ink-* backgrounds
    - Check results form styling — verify V3 input tokens, data color indicators
    - Navigate to `/app/rankings` — verify warm token migration

    **2. Connection Health Indicator (RT-02)**
    - On regatta detail page, look for green "Live" badge in header area
    - The badge should show with a pulsing green dot when connected

    **3. Ranking Animations (RK-01)**
    - Navigate to `/app/rankings`
    - Verify ranking rows have trend sparklines (small inline charts)
    - If rankings recalculate, rows should smoothly animate to new positions

    **4. NCAA Export (RK-02)**
    - On rankings page, find "Export for NCAA" button
    - Click it — verify dialog opens with export info
    - Click "Download CSV" — verify CSV downloads with correct format

    **5. Keyboard Shortcuts (CW-02)**
    - On regattas page, press `?` — should show help overlay
    - Press `N` — should open create regatta form
    - Press `R` — should refresh data
    - Press `Escape` — should close overlays

    **6. Skeleton Loaders (CW-03)**
    - Hard refresh regattas page — should see skeleton shimmer, NOT spinner
    - Hard refresh rankings page — should see skeleton shimmer, NOT spinner

    **7. Optimistic UI (CW-01)**
    - Create or edit a regatta — change should appear instantly before server response
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
All Phase 33 requirements verified:
- REG-01: Polished race day command center with improved results entry
- REG-02: Live race updates via WebSocket
- RK-01: Animated ranking visualizations
- RK-02: NCAA compliance export
- RT-01: Live erg data via WebSocket (replaces polling)
- RT-02: Connection health indicator
- RT-03: Live race day updates via WebSocket
- RT-04: Offline mutations queue and sync
- CW-01: Optimistic UI for all mutations
- CW-02: Keyboard shortcuts
- CW-03: Skeleton loaders instead of spinners
</verification>

<success_criteria>
Human confirms all visual and functional requirements pass. Phase 33 is marked complete in ROADMAP.md and STATE.md.
</success_criteria>

<output>
After completion, create `.planning/phases/33-regattas-rankings-migration/33-06-SUMMARY.md`
</output>
