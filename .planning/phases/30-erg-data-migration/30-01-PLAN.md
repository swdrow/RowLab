---
phase: 30-erg-data-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/v2/components/erg/ErgTestsTable.tsx
  - src/v2/components/erg/ErgProgressChart.tsx
  - src/v2/components/erg/PersonalBestsCard.tsx
  - src/v2/components/erg/ErgTestFilters.tsx
  - src/v2/components/erg/ErgTestForm.tsx
  - src/v2/components/erg/AthleteErgHistory.tsx
  - src/v2/components/erg/C2StatusBadge.tsx
  - src/v2/components/erg/C2SyncButton.tsx
  - src/v2/components/erg/TeamC2StatusList.tsx
  - src/v2/components/erg/ErgCSVImportModal.tsx
  - src/v2/components/erg/ErgColumnMapper.tsx
  - src/v2/components/erg/ErgImportPreview.tsx
  - src/v2/components/erg/ErgEmptyState.tsx
  - src/v2/features/gamification/components/PRCelebration.tsx
autonomous: true

must_haves:
  truths:
    - "All erg components use V3 design tokens instead of hardcoded colors"
    - "Test type badges use semantic design tokens, not raw Tailwind colors"
    - "Chart colors reference CSS custom properties for theme awareness"
    - "PRCelebration uses design tokens instead of hardcoded amber/green"
  artifacts:
    - path: "src/v2/components/erg/ErgTestsTable.tsx"
      provides: "V3-compliant erg tests table with design token colors"
      contains: "data-poor|data-good|data-excellent|data-warning"
    - path: "src/v2/components/erg/ErgProgressChart.tsx"
      provides: "V3-compliant chart with CSS variable colors"
      contains: "getComputedStyle|--color-"
    - path: "src/v2/components/erg/PersonalBestsCard.tsx"
      provides: "V3-compliant personal bests with token colors"
      contains: "data-poor|data-good|data-excellent|data-warning"
    - path: "src/v2/features/gamification/components/PRCelebration.tsx"
      provides: "V3-compliant PR celebration with token colors"
      contains: "accent-gold|SPRING_CONFIG"
  key_links:
    - from: "src/v2/components/erg/ErgTestsTable.tsx"
      to: "design tokens"
      via: "CSS variable-backed classes"
      pattern: "text-data-|bg-data-|border-data-"
---

<objective>
Migrate all erg data components from hardcoded Tailwind colors to V3 design tokens.

Purpose: Every erg component uses raw Tailwind colors (bg-rose-500/10, text-blue-400, #f43f5e, etc.) that violate the V3 design token system. This plan performs a systematic compliance audit and migration to CSS variable-backed tokens.

Output: All 14 erg components + PRCelebration use V3 design tokens with zero hardcoded color violations.
</objective>

<execution_context>
@/home/swd/.claude/get-shit-done/workflows/execute-plan.md
@/home/swd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.claude/design-standard.md
@src/v2/utils/animations.ts
@src/v2/components/erg/ErgTestsTable.tsx
@src/v2/components/erg/ErgProgressChart.tsx
@src/v2/components/erg/PersonalBestsCard.tsx
@src/v2/components/erg/ErgTestFilters.tsx
@src/v2/components/erg/ErgTestForm.tsx
@src/v2/components/erg/AthleteErgHistory.tsx
@src/v2/components/erg/C2StatusBadge.tsx
@src/v2/components/erg/C2SyncButton.tsx
@src/v2/components/erg/TeamC2StatusList.tsx
@src/v2/components/erg/ErgCSVImportModal.tsx
@src/v2/components/erg/ErgColumnMapper.tsx
@src/v2/components/erg/ErgImportPreview.tsx
@src/v2/components/erg/ErgEmptyState.tsx
@src/v2/features/gamification/components/PRCelebration.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate core erg component colors to V3 design tokens</name>
  <files>
    src/v2/components/erg/ErgTestsTable.tsx
    src/v2/components/erg/ErgProgressChart.tsx
    src/v2/components/erg/PersonalBestsCard.tsx
    src/v2/components/erg/ErgTestFilters.tsx
    src/v2/components/erg/ErgTestForm.tsx
    src/v2/components/erg/AthleteErgHistory.tsx
  </files>
  <action>
    Audit and replace all hardcoded Tailwind colors with V3 design tokens. The test type color mapping should use semantic tokens:

    **Test type badge color mapping (applies to ErgTestsTable, PersonalBestsCard, AthleteErgHistory):**
    - `2k` (rose/red) -> `bg-data-poor/10 text-data-poor border-data-poor/30` (red semantic = intense effort)
    - `6k` (blue) -> `bg-data-good/10 text-data-good border-data-good/30` (blue semantic = endurance)
    - `30min` (green) -> `bg-data-excellent/10 text-data-excellent border-data-excellent/30` (green = steady state)
    - `500m` (amber) -> `bg-data-warning/10 text-data-warning border-data-warning/30` (amber = sprint)
    - Default/fallback -> `bg-bg-subtle text-txt-secondary`

    **ErgTestsTable.tsx specific:**
    - Replace `TestTypeBadge` colors object to use design tokens (see mapping above)
    - Replace `bg-red-500/10 text-red-600` on delete button to `bg-status-error/10 text-status-error hover:bg-status-error/20`
    - Replace `text-red-600 hover:text-red-700` on delete icon to `text-status-error hover:text-status-error`
    - Replace loading spinner (`animate-spin rounded-full h-8 w-8 border-b-2`) — leave this for Plan 02 (skeleton replacement)

    **ErgProgressChart.tsx specific:**
    - Replace hardcoded hex colors (`#f43f5e`, `#3b82f6`, `#22c55e`, `#f59e0b`) with CSS variable references
    - Use `getComputedStyle(document.documentElement).getPropertyValue('--color-data-poor')` etc. at render time (or useMemo with a ref)
    - Replace hardcoded `#71717A` for axis strokes with `getComputedStyle(document.documentElement).getPropertyValue('--color-txt-tertiary')`
    - Replace `rgba(255, 255, 255, 0.05)` grid stroke with CSS variable reference

    **PersonalBestsCard.tsx specific:**
    - Replace `testTypeColors` object: `bg-rose-500/10` -> `bg-data-poor/10`, `border-rose-500/30` -> `border-data-poor/30`, `text-rose-400` -> `text-data-poor`, etc. for all four test types
    - Ensure all cards use `glass-card` or `bg-bg-surface border border-bdr-default` patterns

    **ErgTestFilters.tsx specific:**
    - Already mostly compliant (uses bg-interactive-primary, bg-bg-surface, etc.) — just verify no stray hardcoded colors

    **ErgTestForm.tsx specific:**
    - Read and audit for any hardcoded colors. Replace per design token mapping.

    **AthleteErgHistory.tsx specific:**
    - Read and audit for hardcoded colors in personal bests display and chart integration.
    - Apply same test type color mapping as above.
  </action>
  <verify>
    Run: `grep -rn "bg-rose-\|bg-red-\|bg-blue-\|bg-green-\|bg-amber-\|bg-yellow-\|text-rose-\|text-red-\|text-blue-\|text-green-\|text-amber-\|text-yellow-\|bg-gray-" src/v2/components/erg/ErgTestsTable.tsx src/v2/components/erg/ErgProgressChart.tsx src/v2/components/erg/PersonalBestsCard.tsx src/v2/components/erg/ErgTestFilters.tsx src/v2/components/erg/ErgTestForm.tsx src/v2/components/erg/AthleteErgHistory.tsx`
    Should return zero matches.
    Run: `npm run build` — should succeed with no errors.
  </verify>
  <done>
    All 6 core erg components use V3 design tokens exclusively. No hardcoded rose, red, blue, green, amber, yellow, or gray Tailwind color classes remain. Chart colors reference CSS custom properties. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate secondary erg components and PRCelebration to V3 design tokens</name>
  <files>
    src/v2/components/erg/C2StatusBadge.tsx
    src/v2/components/erg/C2SyncButton.tsx
    src/v2/components/erg/TeamC2StatusList.tsx
    src/v2/components/erg/ErgCSVImportModal.tsx
    src/v2/components/erg/ErgColumnMapper.tsx
    src/v2/components/erg/ErgImportPreview.tsx
    src/v2/components/erg/ErgEmptyState.tsx
    src/v2/features/gamification/components/PRCelebration.tsx
  </files>
  <action>
    Read each file and replace hardcoded colors with V3 design tokens.

    **C2StatusBadge.tsx:**
    - Connected status (green): `bg-data-excellent/10 text-data-excellent`
    - Disconnected status (red): `bg-data-poor/10 text-data-poor`
    - Stale/warning status (amber): `bg-data-warning/10 text-data-warning`
    - Unknown status (gray): `bg-bg-subtle text-txt-tertiary`

    **C2SyncButton.tsx:**
    - Success state: `text-data-excellent`
    - Error state: `text-status-error`
    - Syncing state: `text-interactive-primary`

    **TeamC2StatusList.tsx:**
    - Apply same status color mapping as C2StatusBadge
    - Replace any raw Tailwind colors with token equivalents

    **ErgCSVImportModal.tsx:**
    - Replace error styling (`text-red-*`, `bg-red-*`) with `text-status-error`, `bg-status-error/10`
    - Replace success styling (`text-green-*`) with `text-data-excellent`
    - Replace warning styling (`text-amber-*`) with `text-data-warning`
    - Ensure modal uses MODAL_VARIANTS from animations.ts

    **ErgColumnMapper.tsx / ErgImportPreview.tsx:**
    - Replace any hardcoded colors with design tokens.
    - Error/warning indicators should use status-error/data-warning tokens.

    **ErgEmptyState.tsx:**
    - Verify uses design token colors. Replace any stray hardcoded colors.

    **PRCelebration.tsx:**
    - Replace `border-amber-400` with `border-accent-gold`
    - Replace `bg-amber-50 dark:bg-amber-950/50` with `bg-accent-gold/10`
    - Replace `bg-amber-100 dark:bg-amber-900` with `bg-accent-gold/20`
    - Replace `text-amber-600 dark:text-amber-400` with `text-accent-gold`
    - Replace `text-amber-700 dark:text-amber-300` with `text-accent-gold`
    - Replace `text-green-600 dark:text-green-400` with `text-data-excellent`
    - Replace `border-amber-200 dark:border-amber-800` with `border-accent-gold/30`
    - Replace `bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300` with `bg-accent-gold/20 text-accent-gold`
    - Update spring config: Replace `stiffness: 300, damping: 28` with SPRING_CONFIG import from animations.ts (stiffness: 400, damping: 17)
  </action>
  <verify>
    Run: `grep -rn "bg-rose-\|bg-red-\|bg-blue-\|bg-green-\|bg-amber-\|bg-yellow-\|text-rose-\|text-red-\|text-blue-\|text-green-\|text-amber-\|text-yellow-\|bg-gray-\|border-amber-\|border-green-\|border-red-" src/v2/components/erg/C2StatusBadge.tsx src/v2/components/erg/C2SyncButton.tsx src/v2/components/erg/TeamC2StatusList.tsx src/v2/components/erg/ErgCSVImportModal.tsx src/v2/components/erg/ErgColumnMapper.tsx src/v2/components/erg/ErgImportPreview.tsx src/v2/components/erg/ErgEmptyState.tsx src/v2/features/gamification/components/PRCelebration.tsx`
    Should return zero matches.
    Run: `npm run build` — should succeed.
  </verify>
  <done>
    All 8 secondary erg components and PRCelebration use V3 design tokens exclusively. PRCelebration uses SPRING_CONFIG from animations.ts. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "bg-rose-\|bg-red-\|bg-blue-\|bg-green-\|bg-amber-\|bg-yellow-\|text-rose-\|text-blue-\|text-green-\|text-amber-\|text-yellow-\|bg-gray-\|#f43f5e\|#3b82f6\|#22c55e\|#f59e0b\|#71717A" src/v2/components/erg/ src/v2/features/gamification/components/PRCelebration.tsx` — zero matches
2. `npm run build` passes
3. Visually verify test type badges still show differentiated colors (just using tokens now)
</verification>

<success_criteria>
- Zero hardcoded Tailwind color classes in all erg components
- Chart colors reference CSS custom properties
- PRCelebration uses V3 design tokens and SPRING_CONFIG
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-erg-data-migration/30-01-SUMMARY.md`
</output>
